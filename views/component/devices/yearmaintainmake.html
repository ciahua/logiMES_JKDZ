<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>年度保养计划制表</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="../../../layuiadmin/layui/css/layui.css" rel="stylesheet" />
</head>
<body>
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
        <legend>年度保养计划制表</legend>
    </fieldset>
    <div class="layui-card">
        <div class="layui-card-header">选择故障设备</div>
        <div class="layui-card-body">
            <table class="layui-table" lay-data="{url:'../../../Handlers/Handler-devicelist.ashx', where:{actid: 'getTable'}, height:315, page:true, id:'idTest'}" lay-filter="demo">
                <thead>
                    <tr>
                        <!--<th lay-data="{type:'checkbox', fixed: 'left'}"></th>-->
                        <th lay-data="{field:'Id', width:80, sort: true, fixed: true}">ID</th>
                        <th lay-data="{field:'DevNo', sort: true}">设备号</th>
                        <th lay-data="{field:'DevName', minWidth:120, sort: true}">设备名称</th>
                        <th lay-data="{field:'DevType'}">规格型号</th>
                        <!--<th lay-data="{field:'Quantity', width:60}">数量</th>-->
                        <!--<th lay-data="{field:'Vender', minWidth:200}">制造厂家</th>-->
                        <th lay-data="{field:'DevDept', sort: true,}">安装地点</th>
                        <th lay-data="{field:'BuyDate'}">购进日期</th>
                        <!--<th lay-data="{field:'LifeTime'}">使用年限</th>
                        <th lay-data="{field:'DevClass'}">设备类别</th>
                        <th lay-data="{field:'Special'}">特种设备</th>
                        <th lay-data="{field:'Capacity'}">生产能力</th>
                        <th lay-data="{field:'DevState'}">设备状态</th>
                        <th lay-data="{field:'Importance'}">重要程度</th>
                        <th lay-data="{field:'Value'}">设备原值</th>
                        <th lay-data="{field:'ChangeDate'}">变动日期</th>
                        <th lay-data="{field:'ChangeDesc'}">变动内容</th>-->
                        <th lay-data="{fixed: 'right', minWidth:150, align:'center', toolbar: '#barDemo'}">操作</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
    <hr class="layui-bg-green">
    <fieldset class="layui-elem-field site-demo-button" style="margin: 0px 15px 0 15px;">
        <legend>一、二级保养计划</legend>
        <div>
            <form class="layui-form" id="yearform" action="">
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">设备号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="devno" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">设备名称</label>
                        <div class="layui-input-inline">
                            <input type="text" name="devname" id="devname" lay-verify="required" placeholder="" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">规格型号</label>
                        <div class="layui-input-inline">
                            <input type="text" name="devtype" lay-verify="" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">使用部门</label>
                        <div class="layui-input-inline">
                            <input type="text" name="devdept" lay-verify="" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline" style="display:none">
                        <label class="layui-form-label">申报人</label>
                        <div class="layui-input-inline">
                            <input type="text" name="sender" lay-verify="" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                    <div class="layui-inline">
                        <label class="layui-form-label">购进日期</label>
                        <div class="layui-input-inline">
                            <input type="text" name="buydate" lay-verify="" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">保养等级</label>
                    <div class="layui-input-inline">
                        <select name="mon1">
                            <option value="">1月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon2">
                            <option value="">2月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon3">
                            <option value="">3月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon4">
                            <option value="">4月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon5">
                            <option value="">5月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon6">
                            <option value="">6月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">保养等级</label>
                    <div class="layui-input-inline">
                        <select name="mon7">
                            <option value="">7月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon8">
                            <option value="">8月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon9">
                            <option value="">9月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon10">
                            <option value="">10月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon11">
                            <option value="">11月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                    <div class="layui-input-inline">
                        <select name="mon12">
                            <option value="">12月</option>
                            <option value="1">⊙</option>
                            <option value="2">√</option>
                        </select>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-inline">
                        <label class="layui-form-label">年度</label>
                        <div class="layui-input-inline">
                            <input type="text" name="year" id="year" lay-verify="required" autocomplete="off" class="layui-input" readonly="readonly">
                        </div>
                    </div>
                </div>

                <div class="layui-form-item layui-form-text" style="display:none">
                    <label class="layui-form-label">备注</label>
                    <div class="layui-input-block">
                        <textarea placeholder="请输入内容" name="desc" lay-verify="" class="layui-textarea"></textarea>
                    </div>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button type="submit" class="layui-btn" lay-submit="" lay-filter="demo1">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </fieldset>

    <script type="text/html" id="barDemo">
        <a class="layui-btn layui-btn-xs" lay-event="sel">选择</a>
        <!--<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>-->
    </script>

    <script src="../../../layuiadmin/layui/layui.js"></script>
    <script src="../../../Scripts/jquery-3.4.1.js"></script>
    <script>
        layui.use(['form', 'layedit', 'laydate', 'table', 'util'], function () {
            var form = layui.form
                , $ = layui.$
                , layer = layui.layer
                , table = layui.table
                , layedit = layui.layedit
                , laydate = layui.laydate;

            //所获得的 tableIns 即为当前容器的实例
            var tableIns = table.render({
                elem: '#idTest'
                , id: 'idTest'
            });

            //监听行工具事件
            table.on('tool(demo)', function (obj) {
                var data = obj.data;
                //console.log(obj)
                if (obj.event === 'del') {
                    layer.confirm('真的删除该行么？', function (index) {
                        obj.del();
                        layer.close(index);
                        $.ajax({
                            url: '../../../Handlers/Handler-devicelist.ashx',
                            data: { actid: 'delTable', data: JSON.stringify(data) },
                            success: function (res) {
                                alert("删除成功！");
                            },
                            error: function (e) {
                                console.log(e);
                                alert('删除失败！');
                            }
                        });
                    });
                } else if (obj.event === 'sel') {
                    //layer.alert(JSON.stringify(data));
                    //$("input[name='id']").val(data.Id);
                    $("input[name='devno']").val(data.DevNo);
                    $("input[name='devname']").val(data.DevName);
                    $("input[name='devtype']").val(data.DevType);
                    $("input[name='devdept']").val(data.DevDept);
                    $("input[name='sender']").val('嘉腾');
                    $("input[name='buydate']").val(data.BuyDate);
                }
            });

            //日期
            laydate.render({
                elem: '#date'
            });
            laydate.render({
                elem: '#date1'
            });

            laydate.render({
                elem: '#year',
                type: "year"
            });

            //创建一个编辑器
            var editIndex = layedit.build('LAY_demo_editor');

            //自定义验证规则
            form.verify({
                title: function (value) {
                    if (value.length < 5) {
                        return '标题至少得5个字符啊';
                    }
                }
                , pass: [
                    /^[\S]{6,12}$/
                    , '密码必须6到12位，且不能出现空格'
                ]
                , content: function (value) {
                    layedit.sync(editIndex);
                }
            });

            //监听指定开关
            form.on('switch(switchTest)', function (data) {
                layer.msg('开关checked：' + (this.checked ? 'true' : 'false'), {
                    offset: '6px'
                });
                layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
            });

            //监听提交
            form.on('submit(demo1)', function (data) {                
                //layer.alert(JSON.stringify(data.field), {
                //    title: '提交故障信息'
                //});                
                $.ajax({
                    url: '../../../Handlers/Handler-maintenance.ashx',
                    data: { actid: 'insTable', yeardata: JSON.stringify(data.field) },
                    success: function (res) {
                        //alert("故障申报成功！");
                        layer.alert('已提交！', {icon: 6});
                        document.getElementById("yearform").reset();
                    },
                    error: function (e) {
                        console.log(e);
                        alert('删除失败！');
                    }
                });

                return false;
            });     
        });
    </script>

</body>
</html>